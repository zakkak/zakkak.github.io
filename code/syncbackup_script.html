<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>A Sync/BackUp script - Foivos . Zakkak . net</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://foivos.zakkak.net/code/syncbackup_script.html">

        <meta name="author" content="zakkak" />
        <meta name="description" content="1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 ..." />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://foivos.zakkak.net/theme/css/bootstrap.yeti.min.css" type="text/css"/>
    <link href="http://foivos.zakkak.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://foivos.zakkak.net/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://foivos.zakkak.net/theme/css/style.css" type="text/css"/>

        <link href="http://foivos.zakkak.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Foivos . Zakkak . net ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://foivos.zakkak.net/" class="navbar-brand">
Foivos . Zakkak . net            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://foivos.zakkak.net/category/blog.html">Blog</a>
                        </li>
                        <li class="active">
                            <a href="http://foivos.zakkak.net/category/code.html">Code</a>
                        </li>
                        <li >
                            <a href="http://foivos.zakkak.net/category/tutorials.html">Tutorials</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://foivos.zakkak.net/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="http://foivos.zakkak.net" title="Foivos . Zakkak . net"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="http://foivos.zakkak.net/category/code.html" title="Code">Code</a></li>
                <li class="active">A Sync/BackUp script</li>
            </ol>

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://foivos.zakkak.net/code/syncbackup_script.html"
                       rel="bookmark"
                       title="Permalink to A Sync/BackUp script">
                        A Sync/BackUp script
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-04-01T02:34:00"> Mon 01 April 2013</time>
    </span>



    
</footer><!-- /.post-info -->                    </div>
                </div>
                <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="c">#########################################################################</span>
<span class="c">#                                                                       #</span>
<span class="c"># File: backup_settings.sh                    A sync/backup script      #</span>
<span class="c">#                                                                       #</span>
<span class="c">#                                   ++++++++++++++++++++++++++++++      #</span>
<span class="c"># Copyright (C) 2013                + Author:  Foivos S. Zakkak  +      #</span>
<span class="c">#                                   + Website: foivos.zakkak.net +      #</span>
<span class="c">#                                   + Email:   foivos@zakkak.net +      #</span>
<span class="c">#                                   ++++++++++++++++++++++++++++++      #</span>
<span class="c">#                                                                       #</span>
<span class="c"># This program is free software: you can redistribute it and/or modify  #</span>
<span class="c"># it under the terms of the GNU General Public License as published by  #</span>
<span class="c"># the Free Software Foundation, either version 3 of the License, or (at #</span>
<span class="c"># your option) any later version.                                       #</span>
<span class="c">#                                                                       #</span>
<span class="c"># This program is distributed in the hope that it will be useful, but   #</span>
<span class="c"># WITHOUT ANY WARRANTY; without even the implied warranty of            #</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU     #</span>
<span class="c"># General Public License for more details.                              #</span>
<span class="c">#                                                                       #</span>
<span class="c"># You should have received a copy of the GNU General Public License     #</span>
<span class="c"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. #</span>
<span class="c">#                                                                       #</span>
<span class="c">#########################################################################</span>

<span class="c">########################################################################</span>
<span class="c">#                                                                      #</span>
<span class="c"># This is a script to sync configuration files between two directories #</span>
<span class="c"># (HOME and BACKUP_DIR)                                                #</span>
<span class="c">#                                                                      #</span>
<span class="c"># The files are first diffed and if they are not same the most recent  #</span>
<span class="c"># overwrites the older one.                                            #</span>
<span class="c">#                                                                      #</span>
<span class="c"># Limitations: The script does not adapt to file deletions             #</span>
<span class="c">#                                                                      #</span>
<span class="c">########################################################################</span>

<span class="nv">IFS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -en <span class="s2">&quot;\n\b&quot;</span><span class="k">)</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span>.settings_backup

mkdir -p <span class="nv">$BACKUP_DIR</span>
chmod 700 <span class="nv">$BACKUP_DIR</span>

<span class="nv">FILES</span><span class="o">=</span><span class="s2">&quot;</span>
<span class="s2">.aspell.el.prepl</span>
<span class="s2">.aspell.el.pws</span>
<span class="s2">.aspell.en.prepl</span>
<span class="s2">.aspell.en.pws</span>
<span class="s2">.bash_aliases</span>
<span class="s2">.bash_profile</span>
<span class="s2">.gtkrc-2.0</span>
<span class="s2">.ssh/config</span>
<span class="s2">.indent.pro</span>
<span class="s2">.tmux.conf</span>
<span class="s2">.latexmkrc</span>
<span class="s2">.ctags</span>
<span class="s2">.vimrc</span>
<span class="s2">.emacs</span>
<span class="s2">.dircolors</span>
<span class="s2">.dmrc</span>
<span class="s2">.Xresources</span>
<span class="s2">.xvidcaprc</span>
<span class="s2">.notify-osd</span>
<span class="s2">.offlineimaprc</span>
<span class="s2">zakkak_public.asc</span>
<span class="s2">zakkak-public.key</span>
<span class="s2">.fonts.conf&quot;</span>

<span class="nv">FOLDERS</span><span class="o">=</span><span class="s2">&quot;</span>
<span class="s2">.icons</span>
<span class="s2">.themes</span>
<span class="s2">.config/openbox</span>
<span class="s2">.config/gtk-3.0</span>
<span class="s2">.config/Thunar</span>
<span class="s2">.config/tint2</span>
<span class="s2">.config/htop</span>
<span class="s2">.conkycolors</span>
<span class="s2">.local/share/applications</span>
<span class="s2">.fonts</span>
<span class="s2">bin</span>
<span class="s2">Downloads/Apps&quot;</span>

<span class="nv">CURR_DIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
<span class="nb">cd</span> <span class="nv">$HOME</span>
<span class="k">for </span>d in <span class="nv">$FOLDERS</span>
<span class="k">do</span>
<span class="k">    for </span>sd in <span class="sb">`</span>find <span class="nv">$d</span> -type f 2&gt; /dev/null<span class="sb">`</span>
    <span class="k">do</span>
<span class="k">        </span>FILES+<span class="o">=</span><span class="s2">&quot;</span>
<span class="s2">${sd}&quot;</span> <span class="c"># DON&#39;T indent this</span>
    <span class="k">done</span>
<span class="k">done</span>

<span class="nb">cd</span> <span class="nv">$CURR_DIR</span>
<span class="nb">cd</span> <span class="nv">$BACKUP_DIR</span>
<span class="k">for </span>d in <span class="nv">$FOLDERS</span>
<span class="k">do</span>
<span class="k">    for </span>sd in <span class="sb">`</span>find <span class="nv">$d</span> -type f 2&gt; /dev/null<span class="sb">`</span>
    <span class="k">do</span>
        <span class="c"># if [[ ! &quot;$FILES&quot; =~ &quot;$sd&quot; ]] # This check is too expensive</span>
        <span class="c"># then</span>
            FILES+<span class="o">=</span><span class="s2">&quot;</span>
<span class="s2">${sd}&quot;</span> <span class="c"># DON&#39;T indent this</span>
        <span class="c"># fi</span>
    <span class="k">done</span>
<span class="k">done</span>

<span class="c"># Eliminate duplicates</span>
<span class="nv">IFS</span><span class="o">=</span>
<span class="nv">FILES</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> -n <span class="nv">$FILES</span> | sort | uniq<span class="sb">`</span>
<span class="nv">IFS</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -en <span class="s2">&quot;\n\b&quot;</span><span class="k">)</span>

<span class="nb">cd</span> <span class="nv">$CURR_DIR</span>
<span class="k">for </span>f in <span class="nv">$FILES</span>
<span class="k">do</span>
<span class="k">    </span><span class="nv">LOCAL</span><span class="o">=</span><span class="s2">&quot;$HOME/$f&quot;</span>
    <span class="nv">BACKUP</span><span class="o">=</span><span class="s2">&quot;$BACKUP_DIR/$f&quot;</span>
    diff <span class="nv">$LOCAL</span> <span class="nv">$BACKUP</span> 2&gt; /dev/null &gt; /dev/null
    <span class="nv">RES</span><span class="o">=</span><span class="nv">$?</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$RES</span> -ne 2 <span class="o">]</span> <span class="c"># If diff didn&#39;t fail (both files exist)</span>
    <span class="k">then</span>
<span class="k">        if</span> <span class="o">[</span> <span class="nv">$RES</span> -eq 1 <span class="o">]</span> <span class="c"># if there are diffs between the files</span>
        <span class="k">then</span>
            <span class="c"># If local is newer than backup copy to backup else fetch</span>
            <span class="c"># from backup</span>
            <span class="k">if</span> <span class="o">[</span> <span class="nv">$LOCAL</span> -nt <span class="nv">$BACKUP</span> <span class="o">]</span>
            <span class="k">then</span>
<span class="k">                </span>cp <span class="nv">$LOCAL</span> <span class="nv">$BACKUP</span>
                <span class="nb">echo</span> -e <span class="s2">&quot;\033[33;1m --&gt; \033[m&quot;</span> <span class="nv">$f</span>
            <span class="k">else</span>
<span class="k">                </span>cp <span class="nv">$BACKUP</span> <span class="nv">$LOCAL</span>
                <span class="nb">echo</span> -e <span class="s2">&quot;\033[31;1m &lt;-- \033[m&quot;</span> <span class="nv">$f</span>
            <span class="k">fi</span>
<span class="k">        fi</span>
<span class="k">    else</span>
<span class="k">        if</span> <span class="o">[</span> -f <span class="nv">$LOCAL</span> <span class="o">]</span>
        <span class="k">then</span>
<span class="k">            </span><span class="nv">DIR</span><span class="o">=</span><span class="k">${</span><span class="nv">BACKUP</span><span class="p">%/*</span><span class="k">}</span>
            <span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$DIR</span> <span class="o">]</span>
            <span class="k">then</span>
<span class="k">                </span>mkdir -p <span class="nv">$DIR</span>
            <span class="k">fi</span>
<span class="k">            </span>cp <span class="nv">$LOCAL</span> <span class="nv">$BACKUP</span>
            <span class="nb">echo</span> -e <span class="s2">&quot;\033[33;1m --&gt; \033[m&quot;</span> <span class="nv">$f</span>
        <span class="k">elif</span> <span class="o">[</span> -f <span class="nv">$BACKUP</span> <span class="o">]</span>
        <span class="k">then</span>
<span class="k">            </span><span class="nv">DIR</span><span class="o">=</span><span class="k">${</span><span class="nv">LOCAL</span><span class="p">%/*</span><span class="k">}</span>
            <span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$DIR</span> <span class="o">]</span>
            <span class="k">then</span>
<span class="k">                </span>mkdir -p <span class="nv">$DIR</span>
            <span class="k">fi</span>
<span class="k">            </span>cp <span class="nv">$BACKUP</span> <span class="nv">$LOCAL</span>
            <span class="nb">echo</span> -e <span class="s2">&quot;\033[31;1m &lt;-- \033[m&quot;</span> <span class="nv">$f</span>
        <span class="k">else</span>
<span class="k">            </span><span class="nb">echo</span> -e <span class="s2">&quot;\033[37;41;1mFile not found:\033[m&quot;</span> <span class="nv">$f</span>
        <span class="k">fi</span>
<span class="k">    fi</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">

                    <li class="list-group-item"><a href="mailto:foivos_(AT}_zakkak_(DOT}_net"><i class="fa fa-envelope-square fa-lg"></i> Email</a></li>
                    <li class="list-group-item"><a href="https://github.com/zakkak"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
                    <li class="list-group-item"><a href="https://www.linkedin.com/in/zakkak"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>

                    <li class="list-group-item"><a href="/uploads/zakkak_cv.pdf"><i class="fa fa-file-pdf-o fa-lg"></i> My CV</a></li>
                  </ul>
                </li>

                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                    <ul class="list-group" id="recentposts">
                        <li class="list-group-item">
                            <a href="http://foivos.zakkak.net/tutorials/ubuntu_1304_raid1_setup.html">
                                Ubuntu 13.04 RAID-1 setup
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://foivos.zakkak.net/code/syncbackup_script.html">
                                A Sync/BackUp script
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://foivos.zakkak.net/tutorials/getting_started_emacs.html">
                                Getting started with Emacs
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://foivos.zakkak.net/tutorials/using_emacs_and_notmuch_mail_client.html">
                                Using emacs and notmuch as a mail client
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://foivos.zakkak.net/tutorials/google_pdf_viewer_chromium.html">
                                Google PDF viewer on Chromium
                            </a>
                        </li>
                    </ul>
                </li>



    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/zakkak">@zakkak</a> on GitHub
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2013 Foivos S. Zakkak
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution 4.0 International License</a>, except where indicated otherwise.
</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://foivos.zakkak.net/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://foivos.zakkak.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://foivos.zakkak.net/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://foivos.zakkak.net/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'zakkak',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://foivos.zakkak.net/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-29112990-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
</body>
</html>